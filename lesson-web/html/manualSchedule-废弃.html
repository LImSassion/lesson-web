<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>手动预排</title>
		<link rel="stylesheet" href="../bower_components/bootstrap/dist/css/bootstrap.min.css" />
		<link rel="stylesheet" href="../dist/css/AdminLTE.min.css" />
		<style type="text/css">
			td:hover{
				background-color: ghostwhite;
				/*cursor: pointer;*/
				border: #00733E 2px;
				
			}
			th td{
				margin: 5px;
			}
			th.thclass{
				background-color: ghostwhite;
			}
		</style>
		
		
		<!-- jQuery 3 -->
		<script src="../bower_components/jquery/dist/jquery.min.js"></script>
		<!-- Bootstrap 3.3.7 -->
		<script src="../bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
		<!--angular.min.js-->
		<script src="../bower_components/angularjs/angular.min.js"></script>
		
		<!--<script>
			//jquery代码
			$(document).ready(function(){
				$("#schedule tr td").mousemove(function(){
					this.title = "点击添加/删除课程";
				})
			});
			
		</script>-->
		
		<script type="text/javascript">
    	var app = angular.module("ManualScheduleApp",[]);
    	var URI = "http://localhost:8663/lesson/";
    	app.controller("ManualScheduleController",function($scope,$http){		
    		//标题数组
    		$scope.title = ['班级Id', '星期', '节数','timeId', '课程','教师'];
    		
			$scope.nums = ['第一节','第二节','第三节','第四节','第五节','第六节','第七节'];
			
			$scope.mon = [1,2,3,4,5,6,7];
			
			$scope.mon = [{timeId:"1",teacherId:"",remark:"",teacherName:""},
						  {timeId:"2",teacherId:"",remark:"",teacherName:""},
						  {timeId:"3",teacherId:"",remark:"",teacherName:""},
						  {timeId:"4",teacherId:"",remark:"",teacherName:""},
						  {timeId:"5",teacherId:"",remark:"",teacherName:""},
						  {timeId:"6",teacherId:"",remark:"",teacherName:""},
						  {timeId:"7",teacherId:"",remark:"",teacherName:""}]
			
			
			$scope.scheduleList = [];
			
			//初始化一个entity，用于存放课程对象，保存该对象之后，存放到t_preschedule表中
			$scope.entity = {classId:"",timeId:"",teacherId:"",remark:"",teacherName:""};
			
			$scope.saveTimeId = function(timeId){
				$scope.entity.timeId = timeId;
			}
			
			//添加一门课程到列表中
			$scope.addSchedule = function(entity){
				console.log(entity);
				var index = entity.timeId-1;
				console.log("index="+index);
				
				var nomalEntity = {};
				nomalEntity.classId = entity.classId;
				nomalEntity.timeId = entity.timeId;
				nomalEntity.teacherId = entity.teacherId;
				nomalEntity.remark = entity.remark;
				console.log("nolmalEntity:"+nomalEntity);
				
				
				
				$scope.scheduleList[index] = nomalEntity;
				console.log($scope.scheduleList);
			}
			
			
			
			
			$scope.findAllClass = function(){
				$http.get(URI + "class/findAll").success(function(response){
    				$scope.classList = response;
    			});
			}
			
			$scope.findAllClassroom = function(){
				$http.get(URI + "classroom/findAll").success(function(response){
    				$scope.classroomList = response;
    			});
			}
			
			$scope.findAllCourse = function(){
				$http.get(URI + "course/findAll").success(function(response){
    				$scope.courseList = response;
    			});
			}
			
			
//			$scope.test = function(){
//				$scope.testList = [];
//				$scope.entity = {teacherId:2016,remark:"语文",timeId:10,classId:701};
//				console.log($scope.entity);
//				$scope.testList[10] = $scope.entity;
//				console.log($scope.testList);
//				
//				$scope.testList.splice(10,1);
//				console.log($scope.testList);
//			}
		
			//查找所有年级
			$scope.findgrade = function(){
//  			alert("findgrade...");
    			$http.get(URI + "class/findgrade").success(function(response){
    				$scope.grade = response;
    				console.log($scope.grade);
    			})
    		}
			
			//当下拉框的年级发生改变时，调用该函数，查出该年级所有的班别
    		$scope.classChange = function(grade){
//  			alert("查询年级变为："+grade);
				$http.get(URI + "class/findclass/" + grade).success(function(response){
					$scope.classInfo = response;
					console.log($scope.classInfo);
				})
    			
    		}
    		
    		//班级发生改变，查询出当前班级的预排课数据
    		$scope.classNumChange = function(){
//  			alert($scope.classNum);
    		}
    		
		
    		
    	});
    	
    	
    	
    </script>
		
		
	</head>
	<body class="hold-transition skin-red sidebar-mini" ng-app="ManualScheduleApp" ng-controller="ManualScheduleController" ng-init="findgrade();findAllTeacher();findAllClass();findAllClassroom()">
		<div class="box-header with-border">
			<h3 class="box-title">手动预排</h3>
		</div>
		
		<!--<input type="button" value="测试方法" ng-click="test()" />-->
		
		<div class="box-body">

			
			<!--添加、删除预排的课程-->
			<div class="table-box">
                
                <!--查询栏-->
                <div class="container center-block">
				   <div class="row" >
				      
				      <div class="col-md-2 col-sm-2">
				         <span>选择年级：</span>
				      </div>
				      <div class="col-md-3 col-sm-3">
				        <select name="" class="form-control"  ng-model="selectGrade" ng-options="op for op in grade" ng-change="classChange(selectGrade)">
                			<option value=""></option>
                		</select>
				      </div>
				      
				      <div class="col-md-2 col-sm-2">
				         <span>选择班级：</span>
				      </div>
				      <div class="col-md-3 col-sm-3">
				        <select name="" class="form-control"  ng-model="classNum" ng-options="class.classId as class.className for class in classInfo"
				        		ng-change="classNumChange()">
                			<option value=""></option>
                		</select>
				      </div>
				      
				      <div class="col-md-2 col-sm-2">
						<input type="submit" value="开始排课" ng-click="selectCurriculum(teacherId)"/>				      	
				      </div>
					</div>
				</div>
                <br/><br/><br/>
                
                <div class="box-body">
			<div class="table-box">
				<!--
                	描述：工具栏
                	有三个按钮：添加/删除/刷新
                -->
                <div class="pull-left">
                	<div class="form-group form-inline">
                		<p class="text-danger">添加预排前请先选择年级和班级，否则会添加失败！</p>
                		<div class="btn-group">
                			<button type="button" class="btn btn-default" title="添加" data-toggle="modal" data-target="#myModal" ng-click="entity={}">添加预排</button>
	                		<button type="button" class="btn btn-default" title="删除" ng-click="delete(selectIds)">删除预排</button>
	                		<button type="button" class="btn btn-default" title="刷新" onclick="window.location.reload();">刷新</button>	
                		</div>
                	</div>
                </div>
                <!--工具栏-->

				<!--
                	作者：1521484428@qq.com
                	时间：2019-10-15
                	描述：数据表格
                -->
                <table class="table table-bordered table-striped table-hover	">
                	<thead>
                		<tr ng-model="title">
							<th class="" style="padding-right:0px">
	                              <input id="selall" type="checkbox" class="icheckbox_square-blue">
	                          </th> 
							<th ng-repeat="column in title">{{column}}</th>
                			<th class="text-center">操作</th>
                		</tr>
                	</thead>
                	
                	<tbody>
                		<tr ng-repeat="row in list">
                			<!--'courseId', 'classId', 'teacherId', 'courseName', 'courseSort', 'classHour', 'remark'-->
                			<td><input  type="checkbox" ng-click="selectUpdate(row.courseId,$event)"></td>
                			<td>{{row.courseId}}</td>
                			<td>{{row.classId}}</td>
                			<td>{{row.teacherId}}</td>
                			<td>{{row.courseName}}</td>
                			<td>{{row.courseSort}}</td>
                			<td>{{row.classHour}}</td>
                			<td>{{row.remark}}</td>
                			<td class="text-center">                                           
		                 	  <button type="button" class="btn bg-olive btn-xs" data-toggle="modal" data-target="#myModal" ng-click="findOne(row)">修改</button>                                           
		                  </td>
                		</tr>
                	</tbody>
                </table>
                <!--数据表格-->
                <tm-pagination conf="paginationConf"></tm-pagination>
			</div>
			<!--table-box-->
		</div>
		<!--box-body-->
                
                
                
                
                <!--
                	作者：1521484428@qq.com
                	时间：2019-10-15
                	描述：数据表格
                -->
                <table id="schedule" class="table table-bordered ">
                	<thead>
                		<tr>
                			<th>星期  / 时间</th>
							<th ng-repeat="num in nums" class="thclass">{{num}}</th>
                		</tr>
                	</thead>
                	<tbody id="Tbody">
                		<tr id="mon">
                			<th class="thclass">星期一</th>
                			<td ng-repeat="timeId in mon" ng-click="entity={timeId:0};saveTimeId(timeId)"   
                				data-toggle="modal" data-target="#myModal">
                			</td>
                			<!--<td class="one"></td>
                			<td class="two"></td>
                			<td class="three"></td>
                			<td class="four"></td>
                			<td class="five"></td>
                			<td class="six"></td>
                			<td class="seven"></td>-->
                		</tr>
                		<tr id="tue">
                			<th class="thclass">星期二</th>
                			<td class="one"></td>
                			<td class="two"></td>
                			<td class="three"></td>
                			<td class="four"></td>
                			<td class="five"></td>
                			<td class="six"></td>
                			<td class="seven"></td>
                		</tr>
                		<tr id="wedn">
                			<th class="thclass">星期三</th>
                			<td class="one"></td>
                			<td class="two"></td>
                			<td class="three"></td>
                			<td class="four"></td>
                			<td class="five"></td>
                			<td class="six"></td>
                			<td class="seven"></td>
                		</tr>
                		<tr id="thu">
                			<th class="thclass">星期四</th>
                			<td class="one"></td>
                			<td class="two"></td>
                			<td class="three"></td>
                			<td class="four"></td>
                			<td class="five"></td>
                			<td class="six"></td>
                			<td class="seven"></td>
                		</tr>
                		<tr id="fir">
                			<th class="thclass">星期五</th>
                			<td class="one"></td>
                			<td class="two"></td>
                			<td class="three"></td>
                			<td class="four"></td>
                			<td class="five"></td>
                			<td class="six"></td>
                			<td class="seven"></td>
                		</tr>
                	</tbody>
                </table>
                <!--数据表格-->
                
                
			</div>
			<!--table-box-->
			
		</div>
		<!--box-body-->
		
		<!-- 模态框（Modal） -->
		<div class="modal fade" id="myModal" tabindex="-1" role="dialog" 
		  	 aria-labelledby="myModalLabel" aria-hidden="true">
			   <div class="modal-dialog">
			      <div class="modal-content">
			        <div class="modal-header">
        		 		<button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
        		 		<h4 class="modal-title" id="myModalLabel">排课管理</h4>
        		 		<h3 id="myModalLabel">添加课程</h3>
        		 	</div>
        		 	<div class="modal-body">		
						<table class="table table-bordered table-striped"  width="800px">
					      	<!--<tr ng-repeat="stu in student">
					      		<td ng-hide={{$first}}>{{stu}}</td>
					      		<td ng-hide={{$first}}><input  class="form-control" placeholder="{{stu}}" ng-model="entity.{{}}" >  </td>
					      	</tr>-->	
					      	<!--{'studentId':'1', 'studentName':'lxs', 'telephoto':'13215269852', 'email':'123@163.com', 'classId':'201603102', 'remark':'无', 'studentPw':'123465'}
					      	['学生id', '姓名', '电话', '邮箱', '班级id', '备注', '密码'];-->
					      	<!--<tr>
					      		<td>班级</td>
					      		<td>
					      			<select name="" class="form-control"  ng-model="entity.classId" ng-options="class.classId  for class in classList">
			                			<option value=""></option>
			                		</select>
					      		</td>
					      	</tr>-->
					      	<tr>
					      		<td>班级Id</td>
					      		<td ng-model="entity.classId">{{classNum}}</td>
					      	</tr>
					      	<tr>
					      		<td>星期</td>
					      		<td ng-model="entity.classId">{{classNum}}</td>
					      	</tr>
					      	<tr>
					      		<td>节数</td>
					      		<td ng-model="entity.classId">{{classNum}}</td>
					      	</tr>
					      	<tr>
					      		<!--<td>节次</td>-->
					      		<!--<td><input  class="form-control" placeholder="课程" ng-model="entity.email">  </td>-->
					      		<td ng-model="entity.timeId">{{classNum}}</td>
					      	</tr>
					      	<tr>
					      		<td>课程</td>
					      		<!--<td><input  class="form-control" placeholder="课程" ng-model="entity.email">  </td>-->
					      		<td>
					      			<select name="" class="form-control"  ng-model="entity.remark" ng-options="">
			                			<option value=""></option>
			                			<option value="语文">语文</option>
			                			<option value="数学">数学</option>
			                			<option value="英语">英语</option>
			                			<option value="政治">政治</option>
			                		</select>
					      		</td>
					      	</tr>
					      	<tr>
					      		<td>教师</td>
					      		<td>
					      			<select name="" class="form-control"  ng-model="entity.teacherId" ng-options="">
			                			<option value=""></option>
			                			<option value="2016031">王莲</option>
			                			<option value="2016055">刘国梁</option>
			                			<option value="2016066">李撕开</option>
			                			<option value="2016089">程庆成</option>
			                		</select>
					      		</td>
					      	</tr>
					      	
						 </table>				
					</div>
					<div class="modal-footer">						
						<button class="btn btn-success" data-dismiss="modal" aria-hidden="true" ng-click="addSchedule(entity,timeId)">保存</button>
						<button class="btn btn-default" data-dismiss="modal" aria-hidden="true" ng-click="changeStatusToAdd()">关闭</button>
					</div>
        		 </div>
        	</div>
        </div>
        <!--编辑框-->
	
		
	</body>
</html>
